(this["webpackJsonpgraph-montecristo"]=this["webpackJsonpgraph-montecristo"]||[]).push([[0],{245:function(e){e.exports=JSON.parse('{"CONTROLS":"\u0423\u0447\u0440\u0435\u0434\u0438\u0442\u0435\u043b\u044c","ANNOUNCED":"\u041e\u0431\u044a\u044f\u0432\u043b\u0435\u043d\u043d\u044b\u0435 \u043b\u043e\u0442\u044b","DIRECTOR":"\u0414\u0438\u0440\u0435\u043a\u0442\u043e\u0440","INCLUDES_LOTS":"\u0412\u043a\u043b\u044e\u0447\u0430\u0435\u0442 \u043b\u043e\u0442\u044b","NAME_SAKE":"\u0422\u0435\u0437\u043a\u0438","NAME_SAKE_INDIVIDUAL":"\u0422\u0435\u0437\u043a\u0438 \u0418\u041f","PARTICIPATED_IN":"\u0423\u0447\u0430\u0441\u0442\u0432\u043e\u0432\u0430\u043b \u0432","PROBABLE_FATHER":"\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043e\u0442\u0435\u0446","PROBABLE_SIBLING":"\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0431\u0440\u0430\u0442-\u0441\u0435\u0441\u0442\u0440\u0430","PROBABLE_KID":"\u0412\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0441\u044b\u043d-\u0434\u043e\u0447\u044c","SAME_INN":"\u041e\u0434\u0438\u043d\u0430\u043a\u043e\u0432\u044b\u0435 \u0418\u041d\u041d"}')},275:function(e,t,a){e.exports=a(366)},280:function(e,t,a){},281:function(e,t,a){},366:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(21),o=a.n(i),l=(a(280),a(148)),s=a(149),c=a(165),u=a(164),d=(a(281),a(242)),h=a.n(d),p=a(81),g=a(243),m=a(109),b=a(421),f=a(5),v=a(426),C=a(427),E=a(429),y=a(442),k=a(428),S=a(82),G=a(166),O=a(249),T=a.n(O),x=a(430),P=a(425),w=a(422),N=a(424),I=a(423),A=a(248),B=a.n(A),j=a(245),R=function(e,t){if("ru"==t)return j[e]},L=a(192),_=a.n(L),H=a(158),D=a.n(H),J=a(247),Q=a.n(J),M={KgMinjust:{label:"KgMinjust",style:{backgroundColor:"red"},icon:r.a.createElement(_.a,{style:{fontSize:30}}),svg:"https://firebasestorage.googleapis.com/v0/b/newagent-b0720.appspot.com/o/graph-montecristo%2FbusinessIcon%20(3).svg?alt=media&token=3bfb714a-6b0e-4be4-b4ee-92573608a1b9",subHeaderUrlParam:"url",subHeaderText:"\u041c\u0438\u043d\u044e\u0441\u0442",contentTextParam:"name_ru",properties:["name_ru","inn","head_name_sur","street"],links:["CONTROLS","DIRECTOR","SAME_INN"]},KgMinjustParticipants:{label:"KgMinjustParticipants",style:{backgroundColor:"red"},icon:r.a.createElement(D.a,{style:{fontSize:30}}),svg:"https://firebasestorage.googleapis.com/v0/b/newagent-b0720.appspot.com/o/graph-montecristo%2FaccounCircle%20(2).svg?alt=media&token=74846eeb-337b-4923-b87d-c2d3731f62cc",subHeaderUrlParam:"org_url",subHeaderText:"\u041c\u0438\u043d\u044e\u0441\u0442",contentTextParam:"name",properties:["name"],links:["CONTROLS","NAME_SAKE","PROBABLE_FATHER","PROBABLE_SIBLING","PROBABLE_KID"]},HeadNameSur:{label:"HeadNameSur",style:{backgroundColor:"red"},icon:r.a.createElement(D.a,{style:{fontSize:30}}),svg:"https://firebasestorage.googleapis.com/v0/b/newagent-b0720.appspot.com/o/graph-montecristo%2FaccounCircle%20(2).svg?alt=media&token=74846eeb-337b-4923-b87d-c2d3731f62cc",subHeaderUrlParam:"",subHeaderText:"\u041c\u0438\u043d\u044e\u0441\u0442",contentTextParam:"inn",properties:["inn"],links:["DIRECTOR","NAME_SAKE","PROBABLE_FATHER","PROBABLE_SIBLING","PROBABLE_KID"]},KgProcurementParticipants:{label:"KgProcurementParticipants",style:{backgroundColor:"blue"},icon:r.a.createElement(_.a,{style:{fontSize:30}}),svg:"https://firebasestorage.googleapis.com/v0/b/newagent-b0720.appspot.com/o/graph-montecristo%2FbusinessIcon%20(3).svg?alt=media&token=3bfb714a-6b0e-4be4-b4ee-92573608a1b9",subHeaderUrlParam:"",subHeaderText:"\u0413\u043e\u0441. \u0437\u0430\u043a\u0443\u043f\u043a\u0438",contentTextParam:"inn",properties:["inn"],links:["PARTICIPATED_IN","PARTICIPATED_IN","NAME_SAKE_INDIVIDUAL"]},KgProcurementLots:{label:"KgProcurementLots",style:{backgroundColor:"blue"},icon:r.a.createElement(Q.a,{style:{fontSize:30}}),svg:"https://firebasestorage.googleapis.com/v0/b/newagent-b0720.appspot.com/o/graph-montecristo%2FgavelIcon%20(3).svg?alt=media&token=935334ef-fe3f-44bb-ab97-5fbc44d4594d",subHeaderUrlParam:"tender_url",subHeaderText:"\u0413\u043e\u0441. \u0437\u0430\u043a\u0443\u043f\u043a\u0438",contentTextParam:"lot_name",properties:["lot_name"],links:["PARTICIPATED_IN","INCLUDES_LOTS"]}},K=Object(b.a)((function(e){return{root:{backgroundColor:e.palette.background.paper,padding:"1px"},nested:{paddingLeft:e.spacing(4),padding:"1px"},listItemIcon:{minWidth:"auto"}}})),U=r.a.memo((function(e){var t=K(),a=r.a.useState(!0),n=Object(m.a)(a,2),i=(n[0],n[1],e.vGraph.toJS().nodes,e.vGraph.toJS().edges,e.iGraph.toJS().nodes,e.iGraph.toJS().edges),o=Object.keys(i).map((function(t){if(e.node.id.toString()==i[t].source.toString()||e.node.id.toString()==i[t].target.toString())return i[t].type})).reduce((function(e,t){return e[t]?e[t]++:e[t]=1,e}),{});o=Object.keys(o).reduce((function(e,t){return"undefined"!==t&&(e[t]=o[t]),e}),{});var l=e.node.labels[0],s=Object.keys(o).map((function(a){if(M[l]&&M[l].links&&M[l].links.includes(a)){var n=function(t){var a=Object.keys(i).map((function(a){if(i[a].type==t&&(e.node.id.toString()==i[a].source.toString()||e.node.id.toString()==i[a].target.toString()))return a}));return a=a.filter((function(e){return void 0!==e}))}(a);return r.a.createElement(w.a,{style:{padding:"1px"},button:!0,onClick:function(){return e.onButtonClick(n)}},r.a.createElement(I.a,{primary:R(a,"ru")+" ("+o[a]+")",primaryTypographyProps:{variant:"body2"}}),r.a.createElement(N.a,{className:t.listItemIcon},r.a.createElement(B.a,null)))}}));return r.a.createElement(P.a,{component:"nav","aria-labelledby":"nested-list-subheader",className:t.root},s)}),(function(e,t){return e.vGraph===t.vGraph&&e.iGraph===t.iGraph&&e.node===t.node})),z=function(e){var t=new RegExp("\u043e\u0431\u0449\u0435\u0441\u0442\u0432\u043e \u0441 \u043e\u0433\u0440\u0430\u043d\u0438\u0447\u0435\u043d\u043d\u043e\u0439 \u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0435\u043d\u043d\u043e\u0441\u0442\u044c\u044e","i");return e.replace(t,"\u041e\u0441\u041e\u041e")},F=Object(b.a)((function(e){return{contentTextParam:{fontWeight:"bold",marginBottom:"5px"}}})),W=function(e){var t=F(),a=[],n=e.node.labels[0];return Object.keys(M).includes(n)&&M[n].properties.forEach((function(t){M[n].properties&&M[n].properties.includes(t)&&M[n].contentTextParam!==t&&a.push(r.a.createElement(S.a,{variant:"body2",color:"textPrimary",component:"p"},e.node.properties[t]))})),console.log(e.node.properties[M[n].contentTextParam]),r.a.createElement("div",null,r.a.createElement(S.a,{className:t.contentTextParam,variant:"body2",color:"textPrimary",component:"p"},z(e.node.properties[M[n].contentTextParam])),a)},V=Object(b.a)((function(e){return{root:{maxWidth:240,textAlign:"left",height:320},media:{height:0},expand:{transform:"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})},expandOpen:{transform:"rotate(180deg)"},avatar:{backgroundColor:G.a[500]},cardContent:{paddingTop:0,paddingBottom:0}}})),q=r.a.memo((function(e){var t=V(),a=r.a.useState(!1),n=Object(m.a)(a,2),i=(n[0],n[1],{}),o="",l="";if(Object.keys(M).includes(e.node.labels[0])){var s=e.node.labels[0];i=M[s].style,o=M[s].icon,l=r.a.createElement("a",{href:e.node.properties[M[s].subHeaderUrlParam],target:"_blank"},M[s].subHeaderText)}return r.a.createElement(v.a,{className:t.root},r.a.createElement(C.a,{avatar:r.a.createElement(y.a,{"aria-label":"recipe",className:t.avatar,style:i},o),action:r.a.createElement(k.a,{"aria-label":"settings"},r.a.createElement(T.a,null)),subheader:r.a.createElement(S.a,null,l)}),r.a.createElement(E.a,{className:t.cardContent},r.a.createElement(W,{node:e.node}),r.a.createElement(x.a,{style:{marginTop:8}}),r.a.createElement(U,{node:e.node,vGraph:e.vGraph,iGraph:e.iGraph,onButtonClick:e.onButtonClick})))}),(function(e,t){return e.vGraph===t.vGraph&&e.iGraph===t.iGraph&&e.node===t.node})),$=function(e){var t={nodes:Object.values(e.visibleGraph.toJS().nodes),links:Object.values(e.visibleGraph.toJS().edges)},a=[9350,18766,371947];return t.nodes=t.nodes.map((function(t){return a.includes(t.id)?(t.size=3e3,t.renderLabel=!0,t.label=M[t.labels[0]].contentTextParam,t.viewGenerator=function(t){return r.a.createElement(q,{node:t,vGraph:e.visibleGraph,iGraph:e.invisibleGraph,onButtonClick:e.onButtonClick})}):(t.svg=M[t.labels[0]].svg,console.log("SVG ",t),t.size=600,t.renderLabel=!0,t.label=M[t.labels[0]].contentTextParam),t})),t},X=r.a.memo((function(e){return r.a.createElement(g.Graph,{id:"d3graph",data:$(e),config:{height:"600px",width:"100%",staticGraphWithDragAndDrop:!0,nodeHighlightBehavior:!0,node:{color:"lightgreen",labelProperty:"label",highlightStrokeColor:"blue",size:3300,fontSize:16},d3:{linkLength:300,linkStrength:.1},link:{highlightColor:"lightblue"}}})}),(function(e,t){return e.visibleGraph===t.visibleGraph&&e.invisibleGraph===t.invisibleGraph}));function Y(e,t){return e.records.forEach((function(e,a){e.keys.forEach((function(a){var n=e.get(a);n.hasOwnProperty("start")?t.edges[n.identity.low]={source:n.start.low,target:n.end.low,type:n.type,properties:n.properties}:t.nodes[n.identity.low]={id:n.identity.low,labels:n.labels,properties:n.properties}}))})),t}function Z(e,t){return Object.keys(t.edges).forEach((function(a){Object.keys(e.nodes).includes(t.edges[a].source.toString())&&Object.keys(e.nodes).includes(t.edges[a].target.toString())&&(e.edges[a]=t.edges[a])})),e}var ee=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).driver=h.a.driver("bolt://neo4j.kloop.io:7687"),e.state={visibleGraph:p.a.fromJS({nodes:{},edges:{}}),invisibleGraph:p.a.fromJS({nodes:{},edges:{}})},e.clearGraphs=function(){e.setState({visibleGraph:p.a.fromJS({nodes:{},edges:{}}),invisibleGraph:p.a.fromJS({nodes:{},edges:{}})})},e.goClick=function(t){e.executeQuery(t)},e.executeQuery=function(t){var a=e.driver.session();a.run(t).then((function(t){var a=Y(t,e.state.visibleGraph.toJS()),n=Object.keys(a.nodes).toString();e.updateInvisible(n,a,e.state.invisibleGraph.toJS())})).catch((function(e){console.log(e)})).then((function(){return a.close()}))},e.updateInvisible=function(t,a,n){e.driver.session().run("MATCH (n)-[r]-(b) WHERE ID(n) in ["+t+"] RETURN n, r, b").then((function(t){var r=Y(t,n);a=Z(a,r),e.setState({visibleGraph:p.a.fromJS(a),invisibleGraph:p.a.fromJS(r)})}))},e.mergeGraphs=function(t,a,n){t.forEach((function(e){a.edges[e]=n.edges[e],a.nodes[a.edges[e].source]=n.nodes[n.edges[e].source],a.nodes[a.edges[e].target]=n.nodes[n.edges[e].target]}));var r=Z(a,n);return e.updateInvisible(t,r,e.state.invisibleGraph.toJS()),r=Z(r,e.state.invisibleGraph.toJS())},e.handleButtonClick=function(t){var a=e.mergeGraphs(t,e.state.visibleGraph.toJS(),e.state.invisibleGraph.toJS());e.setState({visibleGraph:p.a.fromJS(a)})},e}return Object(s.a)(a,[{key:"componentDidUpdate",value:function(e){e.isGoClick!==this.props.isGoClick&&(this.goClick(this.props.cypherQuery),this.props.goClick()),e.isClearGraph!==this.props.isClearGraph&&(this.clearGraphs(),this.props.clearClick())}},{key:"render",value:function(){var e=null;return 0!==Object.keys(this.state.visibleGraph.toJS().nodes).length&&(e=r.a.createElement(X,{onButtonClick:this.handleButtonClick,visibleGraph:this.state.visibleGraph,invisibleGraph:this.state.invisibleGraph})),r.a.createElement("div",null,e)}}]),a}(n.Component),te=a(438),ae=a(250),ne=a.n(ae),re=a(123),ie=a(193),oe=a(39),le=a(440),se=a(431),ce=a(432),ue=a(433),de=a(251),he=a.n(de),pe=a(256),ge=a.n(pe),me=a(257),be=a.n(me),fe=a(254),ve=a.n(fe),Ce=a(255),Ee=a.n(Ce),ye=a(253),ke=a.n(ye),Se=a(437),Ge=a(436),Oe=a(258),Te=a.n(Oe),xe=a(441),Pe=Object(b.a)((function(e){return{root:{display:"flex"},appBar:{background:"transparent",boxShadow:"none",transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{width:"calc(100% - ".concat(240,"px)"),marginLeft:240,transition:e.transitions.create(["margin","width"],{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen})},menuButton:{color:"gray",marginRight:e.spacing(2)},hide:{display:"none"},drawer:{width:240,flexShrink:0},drawerPaper:{width:240},drawerHeader:Object(ie.a)(Object(ie.a)({display:"flex",alignItems:"center",padding:e.spacing(0,1)},e.mixins.toolbar),{},{justifyContent:"flex-end"}),content:{flexGrow:1,padding:e.spacing(3),transition:e.transitions.create("margin",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),marginLeft:-240},contentShift:{transition:e.transitions.create("margin",{easing:e.transitions.easing.easeOut,duration:e.transitions.duration.enteringScreen}),marginLeft:0},searchBar:{width:"600px",paddingLeft:7,paddingRight:7,border:"2px solid gray",borderRadius:25}}}));function we(e){var t=Pe(),a=Object(oe.a)(),n=r.a.useState(!1),i=Object(m.a)(n,2),o=i[0],l=i[1];return r.a.createElement("div",{className:t.root},r.a.createElement(se.a,null),r.a.createElement(ce.a,{position:"fixed",className:Object(f.a)(t.appBar,Object(re.a)({},t.appBarShift,o))},r.a.createElement(ue.a,null,r.a.createElement(k.a,{color:"inherit","aria-label":"open drawer",onClick:function(){l(!0)},edge:"start",className:Object(f.a)(t.menuButton,o&&t.hide)},r.a.createElement(he.a,null)),r.a.createElement(Se.a,{style:{color:"grey"},className:t.searchBar,value:e.searchText,onChange:e.handleSearchTextChange,placeholder:"Search...",InputProps:{disableUnderline:!0,inputProps:{"aria-label":"Search"}}}),r.a.createElement(xe.a,{title:"Search"},r.a.createElement(k.a,{"aria-label":"search",onClick:e.handleGoClick},r.a.createElement(ke.a,null))),r.a.createElement(xe.a,{title:"Reset"},r.a.createElement(k.a,{"aria-label":"reset",onClick:e.handleResetClick},r.a.createElement(ve.a,null))),r.a.createElement(xe.a,{title:"Clear"},r.a.createElement(k.a,{"aria-label":"clear",onClick:e.handleClearClick},r.a.createElement(Ee.a,null))))),r.a.createElement(le.a,{className:t.drawer,variant:"persistent",anchor:"left",open:o,classes:{paper:t.drawerPaper}},r.a.createElement("div",{className:t.drawerHeader},r.a.createElement(k.a,{onClick:function(){l(!1)}},"ltr"===a.direction?r.a.createElement(ge.a,null):r.a.createElement(be.a,null))),r.a.createElement(x.a,null),r.a.createElement(P.a,null,["Enter your query below"].map((function(e,t){return r.a.createElement(w.a,{key:e},r.a.createElement(I.a,{primary:e}))}))),r.a.createElement(P.a,null,r.a.createElement(Se.a,{id:"query",label:"Query",variant:"outlined",multiline:!0,value:e.cypherQuery,onChange:e.handleCypherQueryTextChange})),r.a.createElement(P.a,null,r.a.createElement(Ge.a,{variant:"contained",className:t.GoButton,onClick:e.handleGoClick,startIcon:r.a.createElement(Te.a,null)},"Run Query"))),r.a.createElement("main",{style:{padding:0,height:"100%"},className:Object(f.a)(t.content,Object(re.a)({},t.contentShift,o))},r.a.createElement("div",{className:t.drawerHeader}),e.children))}var Ne=a(346).default,Ie=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={cypherQuery:"MATCH (n) where id(n) in [2437183, 18766, 2460290, 371947, 9350, 2437735, 1150073] return n",searchText:"",goClick:!1,clearGraph:!1,listOfNodes:[],showPagination:!1},e.handleCypherQueryTextChange=function(t){e.setState({cypherQuery:t.target.value})},e.handleSearchTextChange=function(t){var a="MATCH (n) where n.text_search =~ '.*"+t.target.value+".*' return n";e.setState({searchText:t.target.value,cypherQuery:a})},e.handlePaginationChange=function(t,a){e.handleClearClick();var n="MATCH (n) where id(n) in ["+e.state.listOfNodes[a-1].join()+"] return n";e.setState({cypherQuery:n}),e.handleGoClick()},e.fetchData=function(t){Ne.get(t.url,{params:{token:t.token}}).then((function(t){console.log(t);var a="MATCH (n) where id(n) in ["+t.data[0].join()+"] return n";console.log(a),e.setState({listOfNodes:t.data,showPagination:!0,cypherQuery:a})})).catch((function(e){console.log("There has been a problem with your fetch operation: "+e.message)}))},e.handleGoClick=function(){e.setState({goClick:!0}),console.log("go button clicked"),console.log("state goClicked ",e.state.goClick)},e.goClick=function(){e.setState({goClick:!1})},e.handleClearClick=function(){e.setState({clearGraph:!0})},e.clearClick=function(){e.setState({clearGraph:!1})},e.handleResetClick=function(){e.handleClearClick(),e.handleGoClick()},e}return Object(s.a)(a,[{key:"componentDidMount",value:function(){var e=ne.a.parse(window.location.search,{decode:!1}),t="";console.log("URL STRING",e),e.nodes?(t="MATCH (n) where id(n) in ["+e.nodes+"] return n",console.log("NODES",t),this.setState({cypherQuery:t})):e.url&&(console.log("urlString",e),this.fetchData(e))}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement(we,{cypherQuery:this.state.cypherQuery,handleCypherQueryTextChange:this.handleCypherQueryTextChange,searchText:this.state.searchText,handleSearchTextChange:this.handleSearchTextChange,handleGoClick:this.handleGoClick,handleResetClick:this.handleResetClick,handleClearClick:this.handleClearClick},r.a.createElement(ee,{cypherQuery:this.state.cypherQuery,isGoClick:this.state.goClick,goClick:this.goClick,isClearGraph:this.state.clearGraph,clearClick:this.clearClick}),this.state.showPagination?r.a.createElement(te.a,{count:this.state.listOfNodes.length,onChange:this.handlePaginationChange,showFirstButton:!0,showLastButton:!0}):null))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Ie,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[275,1,2]]]);
//# sourceMappingURL=main.cc3ab775.chunk.js.map